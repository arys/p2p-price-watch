<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>P2P USDT/KZT Chart</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/9.8.2/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/9.8.2/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/9.8.2/firebase-performance-compat.js"></script>
    <!--
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=false"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  </head>
  <body>
    <div style="margin:50px">
      <canvas id="kaspiChart" style="margin-bottom:30px;"></canvas>
      <canvas id="kaspiChartDiff" style="margin-bottom:30px;"></canvas>
      <canvas id="kaspiChartMedian" style="margin-bottom:30px;"></canvas>
      <canvas id="kaspiChartMedianDiff" style="margin-bottom:30px;"></canvas>
      <canvas id="forteChart" style="margin-bottom:30px;"></canvas>
      <canvas id="forteChartDiff" style="margin-bottom:30px;"></canvas>
      <canvas id="forteChartMedian" style="margin-bottom:30px;"></canvas>
      <canvas id="forteChartMedianDiff" style="margin-bottom:30px;"></canvas>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        firebase.database().ref('/').get().then(snapshot => {
          const p2pData = snapshot.val()

          const kaspiChart = new Chart(
            document.getElementById('kaspiChart'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.buy
                  })),
                  label: "Kaspi Buy",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }, {
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.sell
                  })),
                  label: "Kaspi Sell",
                  borderColor: "#D90368",
                  backgroundColor: "#D90368",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const kaspiChartDiff = new Chart(
            document.getElementById('kaspiChartDiff'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.diff
                  })),
                  label: "Kaspi Diff",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const kaspiChartMedian = new Chart(
            document.getElementById('kaspiChartMedian'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianBuy
                  })),
                  label: "Kaspi Median Buy",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }, {
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianSell
                  })),
                  label: "Kaspi Median Sell",
                  borderColor: "#D90368",
                  backgroundColor: "#D90368",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const kaspiChartMedianDiff = new Chart(
            document.getElementById('kaspiChartMedianDiff'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.kaspi).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianDiff
                  })),
                  label: "Kaspi Median Diff",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const forteChart = new Chart(
            document.getElementById('forteChart'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.buy
                  })),
                  label: "Forte Buy",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }, {
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.sell
                  })),
                  label: "Forte Sell",
                  borderColor: "#D90368",
                  backgroundColor: "#D90368",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const forteChartDiff = new Chart(
            document.getElementById('forteChartDiff'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.diff
                  })),
                  label: "Forte Diff",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const forteChartMedian = new Chart(
            document.getElementById('forteChartMedian'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianBuy
                  })),
                  label: "Forte Median Buy",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }, {
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianSell
                  })),
                  label: "Forte Median Sell",
                  borderColor: "#D90368",
                  backgroundColor: "#D90368",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );

          const forteChartMedianDiff = new Chart(
            document.getElementById('forteChartMedianDiff'),
            {
              type: 'line',
              data: {
                labels: [],
                datasets: [{
                  data: Object.entries(p2pData.forte).map(([timestamp, data]) => ({
                    x: new Date(parseInt(timestamp)).toISOString(),
                    y: data.medianDiff
                  })),
                  label: "Forte Median Diff",
                  borderColor: "#3C896D",
                  backgroundColor: "#3C896D",
                }]
              },
              options: {
                scales: {
                  x: {
                    type: 'time',
                    time: {
                      unit: 'minute'
                    }
                  }
                }
              }
            }
          );
        });
      });
    </script>
  </body>
</html>
